---
title: 'ZooKepper'
date: 2020-01-28
permalink: /posts/2020/01/blog-post-15/
tags:
  - Note
---

This is my personal notes for ZooKepper.

ZooKepper简介
------
ZooKeeper是一个分布式服务协调框架，可以用来维护分布式配置信息、服务注册中心、实现分布式锁等。在Hbase、Hadoop、kafka等项目中都有广泛的应用。随着分布式、微服务的普及，ZooKeeper已经成为我们日常开发工作中无法绕过的一环。  
比如zookeeper的节点可以链接两台服务器(客户端和管理后端)，一个是生产者一个是消费者，当生产者发生一个事件(增加节点)，消费者通过监听获得事件信息，通过zk节点中的数据在消费者一端执行相应的操作，可以实现两个服务器的同步。

安装并本地启动ZooKepper
------
[下载地址](https://zookeeper.apache.org/releases.html)  
1 下载3.4.14 (tar.gz文件), 解压到本地目录, 如(/Users/luolingwei/Application/zookepper)  
2 配置环境变量 (vim .bash_profile)  
加上以下内容, Zookepper需要Java编译, 所以会加上JAVA_HOME
```shell
export ZOOKEPPER_HOME=/Users/luolingwei/Application/zookepper
export PATH=$PATH:$ZOOKEPPER_HOME/bin:$JAVA_HOME/bin
```
3 复制conf目录下的"zoo_sample.cfg"并改名为"zoo.cfg", 使其可默认找到  
4 进入bin目录  
./zkServer.sh start, 出现以下内容即启动成功
```shell
ZooKeeper JMX enabled by default
Using config: /Users/luolingwei/Application/zookepper/bin/../conf/zoo.cfg
Starting zookeeper ... STARTED
```

常用命令
------
在bin目录下使用 ./zkCli.sh进入zookepper命令行, 按回车跳过watcher  
出现[zk: localhost:2181(CONNECTED) 0]即进入zookepper命令行

ls / 显示当前所有节点  
create /minitest hellomini 创建minitest节点并设置数据为hellomimi  
get /minitest 获取minitest节点中的数据  
set /minitest updatenew 更新节点中的数据, dataVersion会+1  
delete /minitest 删除minitest节点

常见错误
------
1 报错 Could not find or load main class org.apache.zookeeper.server.quorum.  
解决: 下载含有src目录和jar文件(如zookeeper-3.4.14.jar)的版本

2 找不到配置文件: ZooKeeper JMX enabled by default Using config: ./conf/zoo.cfg Starting zookeeper ... FAILED TO START  
解决: 复制conf目录下的"zoo_sample.cfg"并改名为"zoo.cfg", 或者启动时直接指定配置文件路径

3 报错查看: ./zkServer.sh start-foreground