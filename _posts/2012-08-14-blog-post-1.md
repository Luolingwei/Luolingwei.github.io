---
title: 'CF Algorithms'
date: 2019-03-04
permalink: /posts/2012/08/blog-post-1/
tags:
  - CF
  - Algorithm
---

This is my personal notes for collaborative filtering algorithms (CF), including Item-CF and User-CF.

Overall Introduction
======
目前有关个性化推荐算法主要分为三大类：1.基于协同过滤的推荐；2.基于内容过滤的推荐和；3.社会化推荐。本文主要讨论基于协同过滤(CF)的推荐，而该算法也可以划分为两类(Item-CF, User-CF)。

Item-CF
------
算法流程
* 1.构建用户–>物品的倒排；
* 构建物品与物品的同现矩阵；
* 3.计算物品之间的相似度，即计算相似矩阵；
* 4.根据用户的历史记录，给用户推荐物品；

算法实例:
数据：A;{a,b,d},B:{c,d,e},C:{c,d},D:{b,c,d},E:{a,d}

* 流程1 物品用户倒排

User\Item | a | b | c | d | e
A | 1 | 1 |   | 1 |
B |   |   | 1 | 1 | 1
C |   |   | 1 | 1 |
D |   | 1 | 1 | 1 |
E | 1 |   |   | 1 |

* 流程2 构建物品-物品的同现矩阵
数字表示两种物品同时出现的次数，对角线为空

Item\Item | a | b | c | d | e
a |   | 1 |   | 2 |
b | 1 |   | 2 | 2 | 1
c |   | 2 |   | 2 | 1
d | 2 | 2 | 2 |   |
e |   | 1 | 1 |   |

* 流程3 计算物品之间的相似度，即相似矩阵
$W_{ij}=|N(i)⋂N(j)|/\sqrt{|N(i)||N(j)|}$
分子为物品的同现次数，分母为两物品在用户中出现的总次数

Item\Item | a | b | c | d | e
a |   | 0.41 |   | 0.71 |
b | 0.41 |   | 0.67 | 0.58 | 0.58
c |   | 0.67 |   | 0.58 | 0.58
d | 0.71 | 0.58 | 0.58 |   |
e |   | 0.58 | 0.58 |   |

* 流程4 根据用户的历史记录，给用户推荐物品
最终推荐的什么物品，由预测兴趣度决定。
例如：A用户喜欢a，b，d ，兴趣度分别为1,1,1
    * 推荐c的预测兴趣度=1X0.67+1X0.58=1.25
    * 推荐e的预测兴趣度=1X0.58=0.58

User-CF
------
算法流程:
三个用户分别为A用户、B用户、C用户。他们看过的电影中，既有相同的，也有不同的。
我们需要计算与待推荐的用户A与所有的用户的相似度，进而找到与A用户最相似的N个用户，假设N=1，则需要找到与A用户最相思的1个用户(B)，从而将B看过而A没有看过的电影推荐给A。

相似度计算: Person系数
* Pearson相关系数用来衡量两个数据集合之间的相似性
* Pearson相关系数的一个优点是可以避免评分等级膨胀（grade inflation）的问题，也就是说有的用户可能倾向于对所有的电影都给比较高的分数，而有的用户则会比较苛刻，给分都比较低。对于这种情况，Pearson相关系数可以处理。

Choice of User-CF and Item-CF
------
1、user和item数量分布以及变化频率
* 如果user数量远远大于item数量, 采用Item-CF效果会更好, 因为同一个item对应的打分会比较多, 而且计算量会相对较少
* 如果item数量远远大于user数量, 则采用User-CF效果会更好, 原因同上
* 在实际生产环境中, 有可能因为用户无登陆, 而cookie信息又极不稳定, 导致只能使用item-cf
* 如果用户行为变化频率很慢(比如小说), 用User-CF结果会比较稳定
* 如果用户行为变化频率很快(比如新闻, 音乐, 电影等), 用Item-CF结果会比较稳定

2、相关和惊喜的权衡
* item-based出的更偏相关结果, 出的可能都是看起来比较类似的结果
* user-based出的更有可能有惊喜, 因为看的是人与人的相似性, 推出来的结果可能更有惊喜

3、数据更新频率和时效性要求
* 对于item更新时效性较高的产品, 比如新闻, 就无法直接采用item-based的CF, 因为CF是需要批量计算的, 在计算结果出来之前新的item是无法被推荐出来的, 导致数据时效性偏低;
* 但是可以采用user-cf, 再记录一个在线的用户item行为对, 就可以根据用户最近类似的用户的行为进行时效性item推荐;
* 对于像影视, 音乐之类的还是可以采用item-cf的;